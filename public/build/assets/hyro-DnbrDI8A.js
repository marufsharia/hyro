class p{constructor(){var t;this.csrfToken=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"),this.init()}init(){this.initForms(),this.initModals(),this.initNotifications(),this.initDataTables(),this.initTooltips(),this.initDatePickers(),this.bindGlobalEvents()}bindGlobalEvents(){document.addEventListener("click",t=>{t.target.dataset.hyroConfirm&&(t.preventDefault(),this.handleConfirm(t.target)),t.target.dataset.hyroModal&&(t.preventDefault(),this.openModal(t.target.dataset.hyroModal)),t.target.dataset.hyroModalClose&&(t.preventDefault(),this.closeModal(t.target.closest(".hyro-modal")))})}handleConfirm(t){const o=t.dataset.hyroConfirmMessage||t.getAttribute("title")||t.textContent.trim()||"Are you sure?",e=t.closest("form");this.confirm(o).then(r=>{r&&e&&e.submit()})}initForms(){document.querySelectorAll(".hyro-ajax-form").forEach(t=>{t.addEventListener("submit",async o=>{o.preventDefault();const e=t.querySelector('[type="submit"]'),r=e.textContent;e.disabled=!0,e.textContent="Processing...";try{const a=new FormData(t),s=await fetch(t.action,{method:t.method,body:a,headers:{"X-CSRF-TOKEN":this.csrfToken,Accept:"application/json"}}),n=await s.json();s.ok?(this.showNotification(n.message||"Success!","success"),t.dataset.redirect&&setTimeout(()=>{window.location.href=t.dataset.redirect},1500),t.dataset.reset==="true"&&t.reset()):(this.showNotification(n.message||"An error occurred","danger"),this.displayFormErrors(t,n.errors||{}))}catch{this.showNotification("Network error occurred","danger")}finally{e.disabled=!1,e.textContent=r}})})}displayFormErrors(t,o){t.querySelectorAll(".hyro-form-error").forEach(e=>e.remove()),t.querySelectorAll(".error").forEach(e=>e.classList.remove("error")),Object.entries(o).forEach(([e,r])=>{const a=t.querySelector(`[name="${e}"]`);if(a){const s=document.createElement("div");s.className="hyro-form-error",s.textContent=Array.isArray(r)?r[0]:r,a.parentNode.appendChild(s),a.classList.add("error")}})}initModals(){document.querySelectorAll(".hyro-modal").forEach(t=>{t.addEventListener("click",o=>{o.target===t&&this.closeModal(t)})}),document.addEventListener("keydown",t=>{if(t.key==="Escape"){const o=document.querySelector(".hyro-modal.active");o&&this.closeModal(o)}})}openModal(t){const o=document.getElementById(t);if(o){o.classList.add("active"),document.body.style.overflow="hidden";const e=o.querySelector("input, textarea, select, button");e&&setTimeout(()=>e.focus(),100)}}closeModal(t){t.classList.remove("active"),document.body.style.overflow=""}initNotifications(){document.querySelectorAll(".hyro-alert").forEach(t=>{setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),300)},5e3)})}showNotification(t,o="info",e=""){const r=document.querySelector(".hyro-toast-container")||this.createToastContainer(),a=document.createElement("div");a.className=`hyro-toast hyro-toast-${o}`,a.innerHTML=`
            <div class="hyro-toast-content">
                ${e?`<div class="hyro-toast-title">${e}</div>`:""}
                <div class="hyro-toast-message">${t}</div>
            </div>
            <button class="hyro-toast-close">&times;</button>
        `,a.querySelector(".hyro-toast-close").addEventListener("click",()=>{this.removeToast(a)}),r.appendChild(a),setTimeout(()=>{this.removeToast(a)},5e3)}createToastContainer(){const t=document.createElement("div");return t.className="hyro-toast-container",document.body.appendChild(t),t}removeToast(t){t.style.opacity="0",t.style.transform="translateX(100%)",setTimeout(()=>t.remove(),300)}initDataTables(){document.querySelectorAll(".hyro-table[data-sortable]").forEach(t=>{this.makeTableSortable(t)})}makeTableSortable(t){const o=t.querySelectorAll("th[data-sort]");o.forEach(e=>{e.style.cursor="pointer";const r=document.createElement("span");r.className="hyro-sort-icon",r.innerHTML="↕️",e.appendChild(r),e.addEventListener("click",()=>{const a=e.dataset.sort,s=e.classList.contains("asc");o.forEach(n=>{n.classList.remove("asc","desc")}),e.classList.add(s?"desc":"asc"),this.sortTable(t,a,s)})})}sortTable(t,o,e=!1){const r=t.querySelector("tbody"),a=Array.from(r.querySelectorAll("tr"));a.sort((s,n)=>{var m,h,f,v;const i=s.querySelector(`[data-sort="${o}"]`),c=n.querySelector(`[data-sort="${o}"]`),l=((m=i==null?void 0:i.textContent)==null?void 0:m.trim())||((h=i==null?void 0:i.dataset)==null?void 0:h.value)||"",d=((f=c==null?void 0:c.textContent)==null?void 0:f.trim())||((v=c==null?void 0:c.dataset)==null?void 0:v.value)||"",u=parseFloat(l),y=parseFloat(d);return!isNaN(u)&&!isNaN(y)?e?y-u:u-y:e?d.localeCompare(l):l.localeCompare(d)}),a.forEach(s=>r.appendChild(s))}initTooltips(){document.querySelectorAll("[data-hyro-tooltip]").forEach(t=>{const o=t.dataset.hyroTooltip;t.addEventListener("mouseenter",e=>{const r=document.createElement("div");r.className="hyro-tooltip",r.textContent=o,document.body.appendChild(r);const a=t.getBoundingClientRect();r.style.position="fixed",r.style.left=`${a.left+a.width/2}px`,r.style.top=`${a.top-10}px`,r.style.transform="translateX(-50%) translateY(-100%)",r.style.zIndex="1000",r.style.padding="0.5rem 0.75rem",r.style.backgroundColor="rgba(0, 0, 0, 0.9)",r.style.color="white",r.style.borderRadius="0.375rem",r.style.fontSize="0.75rem",r.style.whiteSpace="nowrap",t.dataset.tooltipId=r}),t.addEventListener("mouseleave",()=>{const e=t.dataset.tooltipId;e&&e.parentNode&&e.parentNode.removeChild(e)})})}initDatePickers(){document.querySelectorAll('input[type="date"]').forEach(t=>{if(!t.value&&t.dataset.defaultToday==="true"){const o=new Date().toISOString().split("T")[0];t.value=o}})}async confirm(t){return new Promise(o=>{const e=document.createElement("div");e.className="hyro-modal active",e.innerHTML=`
                <div class="hyro-modal-content">
                    <div class="hyro-modal-header">
                        <div class="hyro-modal-title">Confirm</div>
                        <button class="hyro-modal-close" data-hyro-modal-close>&times;</button>
                    </div>
                    <div class="hyro-modal-body">
                        <p>${t}</p>
                    </div>
                    <div class="hyro-modal-footer">
                        <button class="hyro-btn hyro-btn-secondary" data-confirm-action="cancel">Cancel</button>
                        <button class="hyro-btn hyro-btn-danger" data-confirm-action="ok">Confirm</button>
                    </div>
                </div>
            `,document.body.appendChild(e),document.body.style.overflow="hidden",e.querySelectorAll("[data-confirm-action]").forEach(r=>{r.addEventListener("click",a=>{a.preventDefault();const s=r.dataset.confirmAction==="ok";e.remove(),document.body.style.overflow="",o(s)})}),e.querySelector("[data-hyro-modal-close]").addEventListener("click",r=>{r.preventDefault(),e.remove(),document.body.style.overflow="",o(!1)})})}showLoading(t){const o=document.createElement("div");if(o.className="hyro-loading",o.innerHTML='<div class="hyro-spinner"></div>',t){const e=t.innerHTML;t.dataset.originalContent=e,t.innerHTML="",t.appendChild(o)}else document.body.appendChild(o);return o}hideLoading(t){if(t){const o=t.querySelector(".hyro-loading");o&&(o.remove(),t.dataset.originalContent&&(t.innerHTML=t.dataset.originalContent))}else document.querySelectorAll(".hyro-loading").forEach(o=>o.remove())}debounce(t,o){let e;return function(...a){const s=()=>{clearTimeout(e),t(...a)};clearTimeout(e),e=setTimeout(s,o)}}async fetchWithTimeout(t,o={}){const{timeout:e=8e3}=o,r=new AbortController,a=setTimeout(()=>r.abort(),e),s=await fetch(t,{...o,signal:r.signal});return clearTimeout(a),s}}document.addEventListener("DOMContentLoaded",()=>{window.Hyro=new p});
